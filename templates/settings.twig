{% extends 'base.twig' %}

{% block title %}Settings - TicketFlow{% endblock %}

{% block layout %}
    {% include '/components/dashboard-header.twig' %}
    {% include '/components/sidebar.twig' with {'page': 'settings'} %}

    <main class="pt-20 lg:pl-64 px-4 py-6">
        <h1 class="text-2xl font-semibold mb-6">Settings</h1>

        <div class="max-w-2xl">
            <form id="settings-form" class="space-y-6">
                {# === Profile Section === #}
                <section class="p-6 bg-white rounded shadow dark:bg-[#3a3734]">
                    <h2 class="text-lg font-semibold mb-4">Profile Settings</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm mb-1">Name</label>
                            <input
                                type="text"
                                name="name"
                                id="name"
                                class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600"
                            />
                        </div>
                        <div>
                            <label class="block text-sm mb-1">Email</label>
                            <input
                                type="email"
                                name="email"
                                id="email"
                                class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600"
                            />
                        </div>
                    </div>
                </section>

                {# === Theme Settings === #}
                <section class="p-6 bg-white rounded shadow dark:bg-[#3a3734]">
                    <h2 class="text-lg font-semibold mb-4">Theme Preferences</h2>
                    <div class="space-y-2">
                        <label class="block text-sm mb-2">Choose Theme</label>
                        <select
                            name="theme"
                            id="theme"
                            class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600"
                        >
                            <option value="system">System Default</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                    </div>
                </section>

                {# === Notification Settings === #}
                <section class="p-6 bg-white rounded shadow dark:bg-[#3a3734]">
                    <h2 class="text-lg font-semibold mb-4">Notification Settings</h2>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-medium">Email Notifications</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                    Receive updates via email
                                </p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input
                                    type="checkbox"
                                    id="notif-email"
                                    class="sr-only peer"
                                />
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-orange-500"></div>
                            </label>
                        </div>

                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-medium">Push Notifications</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                    Receive instant push notifications
                                </p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input
                                    type="checkbox"
                                    id="notif-push"
                                    class="sr-only peer"
                                />
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-orange-500"></div>
                            </label>
                        </div>
                    </div>
                </section>

                {# === Save Button === #}
                <div class="flex justify-end">
                    <button
                        type="submit"
                        class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 transition-colors"
                    >
                        Save Changes
                    </button>
                </div>
            </form>

            {# === Danger Zone === #}
            <section class="mt-8 p-6 bg-white border border-red-200 rounded shadow dark:border-red-900/50 dark:bg-[#3a3734]">
                <h2 class="text-lg font-semibold mb-4 text-red-600 dark:text-red-400">
                    Danger Zone
                </h2>
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="font-medium">Delete Account</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400">
                            Permanently delete your account and all data
                        </p>
                    </div>
                    <button
                        id="delete-account"
                        class="px-4 py-2 text-red-600 border border-red-600 rounded hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors"
                    >
                        Delete Account
                    </button>
                </div>
            </section>
        </div>
    </main>
{% endblock %}

{% block script %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // === Load Session ===
    const session = JSON.parse(localStorage.getItem('ticketapp_session'));
    if (!session) {
        alert('Session expired. Please log in again.');
        window.location.href = '/login.php';
        return;
    }

    // Initialize settings data
    const settings = JSON.parse(localStorage.getItem('settings')) || {
        name: session.user?.name || '',
        email: session.user?.email || '',
        theme: 'system',
        notifications: {
            email: true,
            push: true,
        },
    };

    // === Populate form ===
    document.getElementById('name').value = settings.name;
    document.getElementById('email').value = settings.email;
    document.getElementById('theme').value = settings.theme;
    document.getElementById('notif-email').checked = settings.notifications.email;
    document.getElementById('notif-push').checked = settings.notifications.push;

    // === Save Changes ===
    document.getElementById('settings-form').addEventListener('submit', e => {
        e.preventDefault();

        const updatedSettings = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            theme: document.getElementById('theme').value,
            notifications: {
                email: document.getElementById('notif-email').checked,
                push: document.getElementById('notif-push').checked,
            },
        };

        localStorage.setItem('settings', JSON.stringify(updatedSettings));
        alert('Settings saved successfully.');
    });

    // === Delete Account ===
    document.getElementById('delete-account').addEventListener('click', () => {
        if (confirm('Are you sure? This action cannot be undone.')) {
            localStorage.removeItem('ticketapp_session');
            localStorage.removeItem('tickets');
            localStorage.removeItem('settings');
            alert('Account deleted successfully.');
            window.location.href = '/login.php';
        }
    });
});
</script>
{% endblock %}
